<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<div th:fragment="footer">
    <div id="chatbot-icon">
        ğŸ’¬
    </div>

    <!-- ì±—ë´‡ ì°½ -->
    <div id="chatbot-window">
        <div class="chatbot-header">
            <h2>ì±—ë´‡</h2>
            <button id="close-btn">X</button>
        </div>
        <div class="chatbot-body">
            <div id="chat-log">
                <p>ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</p>
            </div>
        </div>
        <div class="chatbot-footer">
            <input type="text" id="chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <button id="send-btn">ì „ì†¡</button>
        </div>
    </div>


    <div class="bottom-nav">
        <div class="nav-item">
            <button class="icon-button" onclick="location.href='/category'">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                </svg>
            </button>
            <p>ì¹´í…Œê³ ë¦¬</p>
        </div>
        <div class="nav-item">
            <button class="icon-button" onclick="location.href='/snap'">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-stars" viewBox="0 0 16 16">
                    <path d="M7.5 2.5a.5.5 0 0 1 1 0v4.31l1.907-.636a.5.5 0 1 1 .316.949l-2.773.927a.5.5 0 0 1-.635-.398L7.5 2.5z"/>
                </svg>
            </button>
            <p>ìŠ¤ëƒ…</p>
        </div>
        <div class="nav-item">
            <button class="icon-button" onclick="location.href='/'">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                    <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
                </svg>
            </button>
            <p>í™ˆ</p>
        </div>
        <div class="nav-item">
            <button class="icon-button" onclick="location.href='/likes'">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-heart" viewBox="0 0 16 16">
                    <path d="M8 3.314C12.438-1.248 23.534 4.735 8 15-7.534 4.735 3.562-1.248 8 3.314z"/>
                </svg>
            </button>
            <p>ì¢‹ì•„ìš”</p>
        </div>
        <div class="nav-item">
            <button class="icon-button" onclick="location.href='/my'">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 1a5 5 0 0 0-4.546 2.916C4.06 13.286 5.523 14 8 14c2.477 0 3.94-.714 4.546-2.084A5 5 0 0 0 8 9z"/>
                </svg>
            </button>
            <p>ë§ˆì´</p>
        </div>
    </div>
    <div id="footer" style="margin-bottom: 100px">
        <h1>toyproject.2</h1>
    </div>
    <script th:inline="javascript">
        document.addEventListener("DOMContentLoaded", function() {
            const chatbotIcon = document.getElementById('chatbot-icon');
            const chatbotWindow = document.getElementById('chatbot-window');
            const closeBtn = document.getElementById('close-btn');
            const overlay = document.createElement('div');
            const chatInput = document.getElementById('chat-input');
            const sendBtn = document.getElementById('send-btn');
            const chatLog = document.getElementById('chat-log');

            overlay.id = 'chatbot-overlay';
            document.body.appendChild(overlay);

            // ì±—ë´‡ ì•„ì´ì½˜ í´ë¦­ ì‹œ ì±—ë´‡ ì°½ ì—´ê¸°
            chatbotIcon.addEventListener('click', function() {
                chatbotWindow.style.display = 'flex';
                overlay.style.display = 'block';
            });

            // ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ì±—ë´‡ ì°½ ë‹«ê¸°
            closeBtn.addEventListener('click', function() {
                chatbotWindow.style.display = 'none';
                overlay.style.display = 'none';
            });

            // ì±—ë´‡ ì°½ ë°”ê¹¥ì„ í´ë¦­í•˜ë©´ ë‹«ê¸°
            overlay.addEventListener('click', function() {
                chatbotWindow.style.display = 'none';
                overlay.style.display = 'none';
            });

            // ì±—ë´‡ ë‚´ë¶€ë¥¼ í´ë¦­í•  ë•ŒëŠ” ì´ë²¤íŠ¸ ì „íŒŒë¥¼ ë§‰ì•„ ì°½ì´ ë‹«íˆì§€ ì•Šë„ë¡ í•¨
            chatbotWindow.addEventListener('click', function(event) {
                event.stopPropagation();  // ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
            });

            // ì „ì†¡ ë²„íŠ¼ í´ë¦­ ì‹œ ë©”ì‹œì§€ ì „ì†¡
            sendBtn.addEventListener('click', function() {
                sendMessage();
            });

            // ì—”í„°í‚¤ë¥¼ ëˆ„ë¥´ë©´ ë©”ì‹œì§€ ì „ì†¡
            chatInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    sendMessage();
                }
            });

            // ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
            async function sendMessage() {
                const userMessage = chatInput.value.trim();
                if (userMessage) {
                    data =JSON.stringify({ message: userMessage });
                    console.log(data);

                    // ì‚¬ìš©ìì˜ ë©”ì‹œì§€ë¥¼ ì¶”ê°€
                    const userMsgElem = document.createElement('p');
                    userMsgElem.textContent = userMessage;
                    chatLog.appendChild(userMsgElem);

                    // ì…ë ¥ ì°½ ì´ˆê¸°í™”
                    chatInput.value = '';

                    // ì±—ë´‡ ì‘ë‹µ ìƒì„± ì¤‘ í‘œì‹œ
                    const botLoadingElem = document.createElement('p');
                    botLoadingElem.textContent = 'ì‘ë‹µ ìƒì„± ì¤‘...';
                    botLoadingElem.style.fontStyle = 'italic';
                    chatLog.appendChild(botLoadingElem);

                    // ì±— ë¡œê·¸ ì˜ì—­ì„ ìŠ¤í¬ë¡¤ í•˜ë‹¨ìœ¼ë¡œ ì´ë™
                    chatLog.scrollTop = chatLog.scrollHeight;

                    // ì„œë²„ë¡œ ë¹„ë™ê¸° ìš”ì²­ (ì˜ˆ: /api/chatbot ì—”ë“œí¬ì¸íŠ¸ì— POST ìš”ì²­)
                    try {
                        const response = await fetch('/product/testApi', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ message: userMessage })
                        });

                        if (response.ok) {
                            const data = await response.json();

                            // ë¡œë”© ë©”ì‹œì§€ë¥¼ ì§€ìš°ê³  ì‘ë‹µ í‘œì‹œ
                            botLoadingElem.remove();
                            const botMsgElem = document.createElement('p');
                            botMsgElem.textContent = 'ì±—ë´‡ ì‘ë‹µ: ' + data.bot; // ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ì‘ë‹µ
                            botMsgElem.style.backgroundColor = '#e0f7fa';  // ì±—ë´‡ì˜ ì‘ë‹µ ìŠ¤íƒ€ì¼
                            chatLog.appendChild(botMsgElem);

                            // ì±— ë¡œê·¸ ì˜ì—­ì„ ë‹¤ì‹œ ìŠ¤í¬ë¡¤ í•˜ë‹¨ìœ¼ë¡œ ì´ë™
                            chatLog.scrollTop = chatLog.scrollHeight;
                        } else {
                            throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                        }
                    } catch (error) {
                        // ì˜¤ë¥˜ ì²˜ë¦¬
                        botLoadingElem.remove();
                        const errorMsgElem = document.createElement('p');
                        errorMsgElem.textContent = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
                        errorMsgElem.style.color = 'red';
                        chatLog.appendChild(errorMsgElem);
                    }
                }
            }
        });
    </script>
</div>


</html>
